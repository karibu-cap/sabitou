syntax = "proto3";

package audits.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";

/**
 * InventoryTransaction (Journal des Mouvements)
 * Complete audit trail of every inventory change.
 * Auto-generated by all operations that affect stock.
 *
 * Fix: Added batch_id for lot-specific transactions.
 *
 * Example:
 *   transaction_id: "TXN-2025-00123"
 *   warehouse_id: "WH-001"
 *   product_id: "PRD-001"
 *   transaction_type: TXN_TYPE_SALE
 *   quantity_change: -10
 *   quantity_before: 100
 *   quantity_after: 90
 *   related_document_type: "DeliveryNote"
 *   related_document_id: "DN-2025-001"
 *   performed_by_user_id: "USR-003"
 *   batch_id: "BATCH-2025-001"
 */
message InventoryTransaction {
  optional string document_id = 1 [(buf.validate.field).required = true]; // "TXN-2025-00123"
  string store_id = 2;
  string product_id = 3;
  TransactionType transaction_type = 4;
  int32 quantity_change = 5; // Positive = increase, negative = decrease
  int32 quantity_before = 6; // Stock level before
  int32 quantity_after = 7; // Stock level after
  string related_document_type = 8; // "DeliveryNote", "ReceivingNote", etc.
  string related_document_id = 9; // ID of the document
  string performed_by_user_id = 10;
  google.protobuf.Timestamp transaction_time = 11;
  string notes = 12;
  string batch_id = 13; // Specific batch affected
}

enum TransactionType {
  TXN_TYPE_UNSPECIFIED = 0;
  TXN_TYPE_PURCHASE = 1; // Receiving from supplier
  TXN_TYPE_SALE = 2; // Selling to customer
  TXN_TYPE_RETURN_IN = 3; // Customer returning to you
  TXN_TYPE_RETURN_OUT = 4; // You returning to supplier
  TXN_TYPE_TRANSFER_OUT = 5; // Moving to another warehouse
  TXN_TYPE_TRANSFER_IN = 6; // Receiving from another warehouse
  TXN_TYPE_ADJUSTMENT = 7; // Manual adjustment
  TXN_TYPE_DAMAGE = 8; // Damaged goods write-off
  TXN_TYPE_THEFT = 9; // Stolen items
  TXN_TYPE_INITIAL = 10; // Initial stock entry
  TXN_TYPE_EXPIRATION = 11; // Batch expired
}
