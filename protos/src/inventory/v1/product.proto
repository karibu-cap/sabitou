syntax = "proto3";

package inventory.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";

message ProductCategory {
  // The unique identifier of the product category.
  optional string ref_id = 1;

  // The name of the product category.
  string name = 2;
}

message GlobalProduct {
  // The unique identifier of the product.
  optional string ref_id = 1;

  // The name of the product.
  string name = 2;

  // The description of the product.
  optional string description = 3;

  // The bar code value of the product.
  optional string bar_code_value = 4;

  // The product categories of the product.
  repeated ProductCategory categories = 5;

  // The list of image related to the product.
  repeated string images_links_ids = 6;
}

message SupplyEntry {
  // The quantity of the product.
  int32 quantity = 1;

  // The price in XAF of the product.
  int32 price = 2;

  // The unique identifier of the supplier.
  string supplier_id = 3;
}

message StoreProduct {
  // The unique identifier of the business product.
  optional string ref_id = 1;

  // The unique identifier of the store.
  string store_id = 2;

  // The unique identifier of the global product.
  string global_product_id = 3;

  // The price in XAF of the product.
  // The currency is determined by the business.
  optional int32 price = 4;

  // The media ids of the images of the product.
  repeated string images_links_ids = 5;

  // The stock quantity of the product.
  optional int32 stock_quantity = 6;

  // The minimum stock threshold of the product.
  int32 min_stock_threshold = 7;

  // The expiration date of the product.
  optional google.protobuf.Timestamp expiration_date = 8;

  // The inbound date.
  optional google.protobuf.Timestamp inbound_date = 9;

  // The creation date of the product.
  google.protobuf.Timestamp created_at = 10;

  // The last update date of the product.
  optional google.protobuf.Timestamp updated_at = 11;

  // The supplier.
  optional string supplier_id = 12;
}

message FindStoreProductsRequest {
  // The query to search for store products.
  string store_id = 1;

  // The unique identifier of the product.
  optional string ref_id = 2;

  // The unique identifier of the global product.
  optional string global_product_id = 3;

  // Identify the products that are expired.
  optional google.protobuf.Timestamp expiration_date = 4;

  // Identify the products by supplier.
  optional string supplier_id = 5;
}

message FindStoreProductsResponse {
  // The unique identifiers of the products.
  // WARN: all returned products will only have their id and name.
  repeated StoreProduct products = 1;
}

message FindGlobalProductsRequest {
  // The reference id to the global product identifier.
  optional string ref_id = 1;

  // The query to search for products by category.
  repeated ProductCategory categories = 2;

  // Query the product name.
  optional string name = 3;

  // Identify the products by bar code.
  optional string bar_code_value = 4;
}

message FindGlobalProductsResponse {
  // The unique identifiers of the products.
  // WARN: all returned products will only have their id and name.
  repeated GlobalProduct products = 1;
}

message FindCategoryRequest {
  // The query to search for product categories.
  string query = 1;
}

message FindCategoryResponse {
  // The unique identifiers of the product categories.
  // WARN: all returned product categories will only have their id and name.
  repeated ProductCategory categories = 1;
}

message AddStoreProductRequest {
  // The product to add.
  // If the product does not exist, it will be created.
  GlobalProduct global_product = 1;

  // The store product to add.
  StoreProduct store_product = 2;
}

message AddStoreProductResponse {
  // Whether the product was successfully added.
  bool success = 1;
}

message GetStoreProductRequest {
  // The unique identifier of the store product.
  string store_product_id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 3
  ];
}

message GetStoreProductResponse {
  // The retrieved store product data.
  StoreProduct store_product = 1;
}

message UpdateStoreProductRequest {
  // The store product information to update.
  // Note:Only the fields that are set will be updated.
  // Some fields cannot be updated like the product id, store id, and all
  // product fields.
  StoreProduct store_product = 1;

  // The global product information to update.
  // Note:Only the fields that are set will be updated if there is no
  // ref_id set for the global product or will be created in other case.
  optional GlobalProduct global_product = 2;

  // The media ids of the images of the product.
  repeated bytes images_raw_images = 3;
}

message UpdateStoreProductResponse {
  // Whether the store product was successfully updated.
  bool success = 1;
}

message DeleteStoreProductRequest {
  // The unique identifier of the store product.
  string store_product_id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 3
  ];
}

message DeleteStoreProductResponse {
  // Whether the store product was successfully deleted.
  bool success = 1;
}

message StreamStoreProductsRequest {
  // The unique identifier of the store.
  string store_id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 3
  ];

  // Optional filter by supplier ID.
  optional string supplier_id = 2;

  // Optional filter by global product ID.
  optional string global_product_id = 3;
}

message StreamStoreProductsResponse {
  // The store products for the specified store.
  repeated StoreProduct products = 1;
}

message StreamGlobalProductsRequest {
  // Optional filter by global product ID.
  optional string global_product_id = 1;
}

message StreamGlobalProductsResponse {
  // The store products for the specified store.
  repeated GlobalProduct products = 1;
}

service ProductService {
  // Finds products by name.
  rpc FindGlobalProducts(FindGlobalProductsRequest) returns (FindGlobalProductsResponse);

  // Finds categories by name.
  rpc FindCategory(FindCategoryRequest) returns (FindCategoryResponse);

  // Adds a product to a store.
  rpc AddProduct(AddStoreProductRequest) returns (AddStoreProductResponse);

  // Gets a store product by id.
  rpc GetProduct(GetStoreProductRequest) returns (GetStoreProductResponse);

  // Updates a store product.
  rpc UpdateProduct(UpdateStoreProductRequest) returns (UpdateStoreProductResponse);

  // Deletes a store product.
  // Only store products that are not in any orders can be deleted.
  rpc DeleteProduct(DeleteStoreProductRequest) returns (DeleteStoreProductResponse);

  // Finds products by name.
  rpc FindStoreProducts(FindStoreProductsRequest) returns (FindStoreProductsResponse);

  // Streams all products for a store for real-time updates.
  rpc StreamStoreProducts(StreamStoreProductsRequest) returns (stream StreamStoreProductsResponse);
  
  // Streams all global products for real-time updates.
  rpc StreamGlobalProducts(StreamGlobalProductsRequest) returns (stream StreamGlobalProductsResponse);
}
