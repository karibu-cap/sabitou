syntax = "proto3";

package payments.v1;

import "buf/validate/validate.proto";
import "financial/v1/financial_utils.proto";
import "google/protobuf/timestamp.proto";
import "payments/v1/gift_voucher.proto";
import "payments/v1/payments.proto";

/**
 * CashReceipt (Bon de Caisse)
 * Issued at point of sale for immediate payment.
 * Combines invoice + payment proof in one document.
 * Common in retail where customer pays immediately.
 *
 * Fix: Items include batch_id for lot-specific sales (e.g., FIFO for perishables).
 *
 * Example - Retail store sale:
 *   receipt_id: "CASH-2025-001"
 *   cashier_user_id: "USR-005"
 *   customer_id: "CMP-003" (can be null for walk-in)
 *   store_id: "WH-002" (retail store)
 *   items: [1x PRD-001 @ 450000]
 *   subtotal: 450000
 *   tax: 90000
 *   total: 540000
 *   amount_paid: 540000
 *   payment_method: PAYMENT_METHOD_CASH
 *
 * INVENTORY IMPACT: -1 PRD-001 from WH-002
 * ACCOUNTING IMPACT: Immediate revenue + payment
 */
message CashReceipt {
// "CASH-2025-001"
  string document_id = 1 [(buf.validate.field).required = true]; 
  // Who processed sale
  string cashier_user_id = 2; 
  // Can be null for anonymous
  string customer_id = 3; 
  // Which location/store
  string store_id = 4; 
  repeated financial.v1.InvoiceLineItem items = 5;
  double subtotal = 6;
  double tax_amount = 7;
  double total_amount = 8;
  // What customer gave.
  double amount_paid = 9; 
  // Change given to customer.
  double change_given = 10;
  string currency = 11;
  repeated string payment_ids = 12;
  google.protobuf.Timestamp transaction_time = 13;
  string notes = 14;
  // Voucher issued if owed_to_customer > 0.
  optional string voucher_issued_code = 15;
  // Amount owed to customer.
  double owed_to_customer = 16;
}

message CreateCashReceiptRequest {
  // The partial cash receipt to create.
  CashReceipt receipt = 1;

  // The partial payment use by the client.
  repeated payments.v1.Payment payments = 2;

  // Issue voucher on change
  // If true and owed_to_customer > 0, issue a voucher instead of cash
  bool issue_voucher_on_change = 3;
}

message CreateCashReceiptResponse {
  // The created cash receipt.
  bool success = 1;

  // If a voucher was issued.
  optional payments.v1.GiftVoucher voucher = 2; 
}



service CashReceiptService {
  // Create a cash receipt (most common - 95% of transactions)
  rpc CreateCashReceipt(CreateCashReceiptRequest) returns (CreateCashReceiptResponse);

}
