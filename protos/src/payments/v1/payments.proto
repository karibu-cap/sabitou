syntax = "proto3";

package payments.v1;

import "buf/validate/validate.proto";
import "financial/v1/invoice.proto";
import "google/protobuf/timestamp.proto";
import "payments/v1/payment_utils.proto";

/**
 * Payment represents money transfer between parties.
 * Links to invoices to track what's been paid.
 *
 * Example:
 *   payment_id: "PAY-2025-001"
 *   payer_id: "CMP-003" (customer)
 *   payee_id: "CMP-001" (your company)
 *   amount: 5400000
 *   payment_method: PAYMENT_METHOD_BANK_TRANSFER
 *   related_invoice_id: "INV-2025-001"
 *   status: PAYMENT_STATUS_COMPLETED
 */
message Payment {
  string document_id = 1 [(buf.validate.field).required = true]; // "PAY-2025-001"
  string payer_id = 2; // Who pays
  string payee_id = 3; // Who receives
  double amount = 4; // Amount in smallest currency unit
  string currency = 5;
  payments.v1.PaymentMethod payment_method = 6;
  PaymentStatus status = 7;
  string related_invoice_id = 8; // Which invoice this pays
  google.protobuf.Timestamp payment_date = 9;
  string reference_number = 10; // Bank reference, check number, etc.
  string created_by_user_id = 11;
  string notes = 12;
}

enum PaymentStatus {
  PAYMENT_STATUS_UNSPECIFIED = 0;
  PAYMENT_STATUS_PENDING = 1; // Initiated but not confirmed
  PAYMENT_STATUS_COMPLETED = 2; // Money received
  PAYMENT_STATUS_FAILED = 3; // Payment didn't go through
}

enum PaymentMethod {
  PAYMENT_METHOD_UNSPECIFIED = 0;
  PAYMENT_METHOD_CASH = 1; // Physical cash
  PAYMENT_METHOD_CREDIT_CARD = 2; // Card payment
  PAYMENT_METHOD_MOBILE_MONEY = 3; // MTN, Orange Money, etc.
  PAYMENT_METHOD_VOUCHER = 4; // payment with voucher
  PAYMENT_METHOD_ORANGE_MONEY = 5; // Orange Money
  PAYMENT_METHOD_MTN_MONEY = 6; // MTN Money
}

service PaymentService {
  // Record a payment
  rpc CreatePayment(CreatePaymentRequest) returns (CreatePaymentResponse);

  // Get payment details
  rpc GetPayment(GetPaymentRequest) returns (GetPaymentResponse);

  // List payments with filtering
  rpc ListPayments(ListPaymentsRequest) returns (ListPaymentsResponse);

  // Process refund
  rpc CreateRefund(CreateRefundRequest) returns (CreateRefundResponse);
}

message CreatePaymentRequest {
  string payer_id = 1; // Company making payment
  string payee_id = 2; // Company receiving payment
  double amount = 3;
  string currency = 4;
  PaymentMethod payment_method = 5;
  optional string reference_number = 7; // Bank ref, check number, etc.
  optional string notes = 8;
}

message CreatePaymentResponse {
  string payment_id = 1;
  Payment payment = 2;
  financial.v1.Invoice updated_invoice = 3; // Updated status
  string message = 4;
}

message GetPaymentRequest {
  string payment_id = 1;
}

message GetPaymentResponse {
  Payment payment = 1;
  financial.v1.Invoice related_invoice = 2;
}

message ListPaymentsRequest {
  string store_id = 1; // Payments involving this company
  PaymentMethod method = 2; // Filter by method
  PaymentStatus status = 3; // Filter by status
  google.protobuf.Timestamp start_date = 4;
  google.protobuf.Timestamp end_date = 5;
  int32 page_size = 6;
  int32 page_number = 7;
}

message ListPaymentsResponse {
  repeated Payment payments = 1;
  int32 total_count = 2;
  double total_amount = 3;
}

message CreateRefundRequest {
  string original_payment_id = 1;
  string credit_note_id = 2; // Reason for refund
  double refund_amount = 3;
  string refunded_by_user_id = 4;
  string notes = 5;
}

message CreateRefundResponse {
  string refund_payment_id = 1;
  Payment refund_payment = 2;
  string message = 3;
}
